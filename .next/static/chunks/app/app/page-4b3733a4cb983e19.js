(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[466],{1607:(e,s,t)=>{Promise.resolve().then(t.bind(t,4444))},4444:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>Z});var r=t(5155),a=t(2115),n=t(4085),i=t(5007),l=t(2336),c=t(4194),o=t(1190),d=t(6164),u=t(7156),m=t(3831),p=t(8283),x=t(4624);async function h(e,s){try{let t="AIzaSyCjLMlEx2Aaw5j-NJYWz3K4Z_kvvh6irEY";if(console.log("API Key:",t),!t)throw Error("Google Cloud API key is not configured");let r=new x.ij(t).getGenerativeModel({model:"gemini-1.5-flash"}),a=[{text:'You are an AI assistant helping a person do their work independently. Based on what you see through the camera and hear from the user input, provide clear, step-by-step guidance. The user asks: "{input}". Respond in a helpful, friendly conversational tone. Focus on practical solutions and clear instructions. DO NOT LIE or make assumptions about capabilities you don\'t have.'.replace("{input}",e)}];s&&a.push({text:"Image: [data:image/jpeg;base64,".concat(s,"]")});let n=(await r.generateContent({contents:[{role:"user",parts:a}]})).response;if(!n.text())throw Error("No text response from Gemini API");return{text:n.text()}}catch(e){return console.error("Error calling Gemini API:",e),{text:"",error:"Failed to get response from AI. Please try again."}}}let f=0,g=new Map,j=e=>{if(g.has(e))return;let s=setTimeout(()=>{g.delete(e),N({type:"REMOVE_TOAST",toastId:e})},1e6);g.set(e,s)},v=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===s.toast.id?{...e,...s.toast}:e)};case"DISMISS_TOAST":{let{toastId:t}=s;return t?j(t):e.toasts.forEach(e=>{j(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===t||void 0===t?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===s.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==s.toastId)}}},w=[],y={toasts:[]};function N(e){y=v(y,e),w.forEach(e=>{e(y)})}function S(e){let{...s}=e,t=(f=(f+1)%Number.MAX_VALUE).toString(),r=()=>N({type:"DISMISS_TOAST",toastId:t});return N({type:"ADD_TOAST",toast:{...s,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>N({type:"UPDATE_TOAST",toast:{...e,id:t}})}}var b=t(4505);function A(e){let{response:s,isLoading:t,onResponseEnd:n}=e,l=(0,a.useRef)(null);return((0,a.useEffect)(()=>(s&&!t&&(l.current=new SpeechSynthesisUtterance(s),l.current.onend=()=>{null==n||n()},window.speechSynthesis.speak(l.current)),()=>{l.current&&window.speechSynthesis.cancel()}),[s,t,n]),t)?(0,r.jsxs)(i.Zp,{className:"p-4 flex items-center justify-center",children:[(0,r.jsx)(b.A,{className:"h-6 w-6 animate-spin"}),(0,r.jsx)("span",{className:"ml-2",children:"Processing your request..."})]}):s?(0,r.jsx)(i.Zp,{className:"p-4 space-y-2",children:(0,r.jsx)("p",{className:"text-lg",children:s})}):null}var E=t(5084),k=t(9602),C=t(9246),I=t(7215),T=t(6699),O=t(8173),R=t.n(O);function _(){let[e,s]=(0,a.useState)(!1),[t,x]=(0,a.useState)(!1),[f,g]=(0,a.useState)(!1),[j,v]=(0,a.useState)(""),[b,O]=(0,a.useState)(""),[_,D]=(0,a.useState)(""),[M,P]=(0,a.useState)({cameras:[],mics:[]}),[L,U]=(0,a.useState)(!1),[Z,G]=(0,a.useState)(!1),$=(0,a.useRef)(null),F=(0,a.useRef)(null),{isLoading:V,response:W,getResponse:q}=function(){let[e,s]=(0,a.useState)(!1),[t,r]=(0,a.useState)(""),{toast:n}=function(){let[e,s]=a.useState(y);return a.useEffect(()=>(w.push(s),()=>{let e=w.indexOf(s);e>-1&&w.splice(e,1)}),[e]),{...e,toast:S,dismiss:e=>N({type:"DISMISS_TOAST",toastId:e})}}();return{isLoading:e,response:t,getResponse:async(e,t)=>{s(!0);try{let s=await h(e,t);if(s.error)return n({title:"Error",description:s.error,variant:"destructive"}),null;return r(s.text),s.text}catch(e){return n({title:"Error",description:"Failed to get AI response. Please try again.",variant:"destructive"}),null}finally{s(!1)}}}}(),{language:K}=(0,E.o)(),Y=(0,a.useRef)(null),z=(0,a.useRef)(null),{fontSize:B,lineHeight:H,letterSpacing:J}=(0,I.t)();(0,a.useEffect)(()=>{(async function(){try{let e=await navigator.mediaDevices.enumerateDevices(),s=e.filter(e=>"videoinput"===e.kind),t=e.filter(e=>"audioinput"===e.kind);P({cameras:s,mics:t}),s.length&&O(s[0].deviceId),t.length&&D(t[0].deviceId)}catch(e){console.error("Error getting devices:",e)}})()},[]),(0,a.useEffect)(()=>{(async()=>{await X(!0),await ee(!0)})()},[]);let X=async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if((e||t)&&(F.current&&F.current.getTracks().forEach(e=>e.stop()),$.current&&($.current.srcObject=null)),!e||t){let e=await navigator.mediaDevices.getUserMedia({video:{deviceId:b}});$.current&&($.current.srcObject=e),F.current=e}s(!e||t)}catch(e){console.error("Error toggling camera:",e)}},Q=(0,a.useCallback)(()=>{window.speechSynthesis.cancel(),g(!1),L&&(ee(!0),U(!1))},[L]),ee=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(Q(),(t||e)&&(F.current&&F.current.getTracks().forEach(e=>{"audio"===e.kind&&e.stop()}),Y.current&&Y.current.stop()),!t||e){let e=await navigator.mediaDevices.getUserMedia({audio:{deviceId:_}});F.current=e,er()}x(!t||e)}catch(e){console.error("Error toggling microphone:",e)}},es=async()=>{if(!$.current)return null;let e=document.createElement("canvas");e.width=$.current.videoWidth,e.height=$.current.videoHeight;let s=e.getContext("2d");return s?(s.drawImage($.current,0,0),e.toDataURL("image/jpeg").split(",")[1]):null},et=async()=>{if(!j.trim())return;let s=e?await es():void 0;await q(j,"string"==typeof s?s:void 0),v("")},er=()=>{if(!("SpeechRecognition"in window||"webkitSpeechRecognition"in window)){console.error("Speech recognition is not supported in this browser.");return}let s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s){console.error("Speech recognition is not supported in this browser.");return}Y.current=new s,Y.current.lang=K,Y.current.interimResults=!1,Y.current.maxAlternatives=1,Y.current.onresult=async s=>{let t=s.results[0][0].transcript.trim().toLowerCase();if(console.log('Voice command detected: "'.concat(t,'"')),await ee(!1),await ea(t))L||await ee(!0);else{v(t);let s=e?await es():void 0;await q(t,"string"==typeof s?s:void 0)}},Y.current.onerror=e=>{console.error("Speech recognition error:",e.error)},Y.current.onend=()=>{if(t&&!L){var e;null===(e=Y.current)||void 0===e||e.start()}},Y.current.start()},ea=(0,a.useCallback)(async e=>e.includes("start camera")?(await X(!0),!0):e.includes("stop camera")?(await X(!1),!0):e.includes("start mic")?(await ee(!0),!0):e.includes("stop mic")?(await ee(!1),!0):!!(e.includes("repeat")||e.includes("respeak"))&&(await en(),!0),[W]),en=async()=>{if(!W)return;t&&(await ee(!1),U(!0));let e=new SpeechSynthesisUtterance(W);z.current=e,g(!0),e.onend=()=>{g(!1),L&&(ee(!0),U(!1))},e.onerror=()=>{g(!1),L&&(ee(!0),U(!1))},window.speechSynthesis.speak(e)};return(0,r.jsxs)("div",{className:"flex w-100 flex-col space-y-4 my-4",style:{fontSize:B,lineHeight:H,letterSpacing:"".concat(J,"px")},children:[(0,r.jsx)("div",{className:"relative h-[40vh] shrink-0",children:(0,r.jsxs)(i.Zp,{className:"h-full w-full overflow-hidden",children:[(0,r.jsx)("video",{ref:$,autoPlay:!0,playsInline:!0,muted:!0,className:(0,k.cn)("w-full h-full object-cover",!e&&"hidden")}),!e&&(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-muted",children:(0,r.jsx)(c.A,{className:"w-12 h-12 text-muted-foreground"})})]})}),(0,r.jsx)("div",{className:"h-[15vh] overflow-y-auto",children:(0,r.jsx)(i.Zp,{className:"h-full p-4",children:(0,r.jsx)(A,{response:W,isLoading:V,onResponseEnd:()=>{}})})}),(0,r.jsx)(T.O,{open:Z,onOpenChange:G}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 w-100 xl:flex-row",children:[(0,r.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,r.jsxs)(n.$,{variant:e?"default":"outline",onClick:()=>X(),className:"flex-1 relative min-h-[48px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[e?(0,r.jsx)(o.A,{className:"mr-2"}):(0,r.jsx)(c.A,{className:"mr-2"}),(0,r.jsx)("span",{children:e?"Stop Camera":"Start Camera"})]}),e?(0,r.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),(0,r.jsx)("span",{className:"text-s text-green-500",children:"Live"})]}):(0,r.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,r.jsx)("span",{className:"text-s text-red-500",children:"Off"})]})]}),(0,r.jsxs)(C.m_,{children:[(0,r.jsx)(C.k$,{asChild:!0,children:(0,r.jsxs)(n.$,{variant:t?"default":"outline",onClick:()=>ee(),className:"flex-1 relative min-h-[48px]",children:[(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[t?(0,r.jsx)(d.A,{className:"mr-2"}):(0,r.jsx)(u.A,{className:"mr-2"}),(0,r.jsx)("span",{children:t?"Stop Mic":"Start Mic"})]}),f?(0,r.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-yellow-500 animate-pulse"}),(0,r.jsx)("span",{className:"text-s text-yellow-500",children:"Paused"})]}):t?(0,r.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),(0,r.jsx)("span",{className:"text-s text-green-500",children:"Listening"})]}):(0,r.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,r.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,r.jsx)("span",{className:"text-s text-red-500",children:"Off"})]})]})}),(0,r.jsx)(C.ZI,{side:"top",align:"center",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("p",{children:"Available voice commands:"}),(0,r.jsxs)("ul",{className:"list-disc pl-4",children:[(0,r.jsx)("li",{children:"start camera"}),(0,r.jsx)("li",{children:"stop camera"}),(0,r.jsx)("li",{children:"start mic"}),(0,r.jsx)("li",{children:"stop mic"}),(0,r.jsx)("li",{children:"repeat"}),(0,r.jsx)("li",{children:"respeak"})]})]})})]}),(0,r.jsx)(n.$,{asChild:!0,variant:"secondary",className:"flex-1 relative min-h-[48px]",children:(0,r.jsxs)(R(),{href:"/call-assistant",children:[(0,r.jsx)(m.A,{className:"mr-2"}),(0,r.jsx)("span",{children:"Call Assistance"})]})})]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,r.jsx)(l.p,{value:j,onChange:e=>v(e.target.value),placeholder:"Type your question or command...",onKeyPress:e=>"Enter"===e.key&&et(),className:"flex-1"}),(0,r.jsx)(n.$,{className:"w-16 h-16",onClick:et,children:(0,r.jsx)(p.A,{className:"w-8 h-8"})})]})]})]})}var D=t(7837),M=t(3348),P=t(8867);function L(e){let{onComplete:s}=e;return(0,r.jsx)(D.lG,{open:!0,onOpenChange:s,children:(0,r.jsxs)(D.Cf,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(D.c7,{children:[(0,r.jsx)(D.L3,{children:"Welcome to Lifesight"}),(0,r.jsx)(D.rr,{children:"Let's get you started with using our AI-powered assistant."})]}),(0,r.jsxs)("div",{className:"py-4 space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(o.A,{className:"w-5 h-5 mt-0.5 text-primary"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium",children:"Camera Access"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"We'll use your camera to help understand your surroundings"})]})]}),(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(d.A,{className:"w-5 h-5 mt-0.5 text-primary"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium",children:"Voice Commands"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Speak naturally to interact with the assistant"})]})]}),(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,r.jsx)(M.A,{className:"w-5 h-5 mt-0.5 text-primary"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium",children:"Text Input"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Type your questions if you prefer text communication"})]})]})]}),(0,r.jsx)(D.Es,{children:(0,r.jsxs)(n.$,{onClick:s,className:"w-full",children:[(0,r.jsx)(P.A,{className:"w-4 h-4 mr-2"}),"Get Started"]})})]})})}var U=t(4721);function Z(){let[e,s]=(0,U.M)("hasSeenOnboarding",!1),[t,n]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{n(!0),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).catch(e=>console.error("Error accessing media devices:",e))},[]),t)?(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("main",{className:(0,k.cn)("bg-background overflow-hidden"),children:(0,r.jsxs)(C.Bc,{children:[(0,r.jsx)(_,{}),!e&&(0,r.jsx)(L,{onComplete:()=>s(!0)})]})})}):null}},5007:(e,s,t)=>{"use strict";t.d(s,{Zp:()=>i});var r=t(5155),a=t(2115),n=t(9602);let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});i.displayName="Card",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...a})}).displayName="CardHeader",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("h3",{ref:s,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})}).displayName="CardTitle",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("p",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})}).displayName="CardDescription",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",t),...a})}).displayName="CardContent",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",t),...a})}).displayName="CardFooter"},2336:(e,s,t)=>{"use strict";t.d(s,{p:()=>i});var r=t(5155),a=t(2115),n=t(9602);let i=a.forwardRef((e,s)=>{let{className:t,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,n.cn)("flex h-16 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...i})});i.displayName="Input"}},e=>{var s=s=>e(e.s=s);e.O(0,[664,445,774,127,283,441,517,358],()=>s(1607)),_N_E=e.O()}]);