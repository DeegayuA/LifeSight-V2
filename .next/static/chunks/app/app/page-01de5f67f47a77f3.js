(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[466],{1607:(e,t,s)=>{Promise.resolve().then(s.bind(s,4330))},4330:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>G});var a=s(5155),r=s(2115),n=s(4085),i=s(5007),l=s(2336),c=s(4194),o=s(1190),d=s(6164),u=s(7156),m=s(3831),f=s(8283),h=s(4624),p=s(5494);async function x(e,t){try{let s="AIzaSyCjLMlEx2Aaw5j-NJYWz3K4Z_kvvh6irEY";if(!s)throw Error("Google Cloud API key is not configured");let a=new h.ij(s).getGenerativeModel({model:"gemini-1.5-flash"}),r=[{text:p.VE.replace("{input}",e)}];t&&(console.log("Image base64 data:",t.substring(0,20)+"..."),t.length>0?r.push({inlineData:{data:t,mimeType:"image/jpeg"}}):console.warn("Image data is empty, not sending image to Gemini API."));let n=(await a.generateContent({contents:[{role:"user",parts:r}]})).response;if(!n.text())throw Error("No text response from Gemini API");return{text:n.text()}}catch(e){return console.error("Error calling Gemini API:",e),{text:"",error:"Failed to get response from AI. Please try again."}}}let g=0,v=new Map,w=e=>{if(v.has(e))return;let t=setTimeout(()=>{v.delete(e),S({type:"REMOVE_TOAST",toastId:e})},1e6);v.set(e,t)},j=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?w(s):e.toasts.forEach(e=>{w(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},y=[],N={toasts:[]};function S(e){N=j(N,e),y.forEach(e=>{e(N)})}function b(e){let{...t}=e,s=(g=(g+1)%Number.MAX_VALUE).toString(),a=()=>S({type:"DISMISS_TOAST",toastId:s});return S({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>S({type:"UPDATE_TOAST",toast:{...e,id:s}})}}var k=s(4505),C=s(7215);function I(e){let{response:t,isLoading:s,onResponseEnd:n}=e,l=(0,r.useRef)(null),{fontSize:c,accentColor:o}=(0,C.t)();return((0,r.useEffect)(()=>(t&&!s&&(l.current=new SpeechSynthesisUtterance(t),l.current.onend=()=>{null==n||n()},window.speechSynthesis.speak(l.current)),()=>{l.current&&window.speechSynthesis.cancel()}),[t,s,n]),s)?(0,a.jsxs)(i.Zp,{className:"p-4 flex items-center justify-center",children:[(0,a.jsx)(k.A,{className:"h-6 w-6 animate-spin",style:{color:o}}),(0,a.jsx)("span",{className:"ml-2",style:{fontSize:"".concat(c/16,"rem")},children:"Processing your request..."})]}):t?(0,a.jsx)(i.Zp,{className:"p-4 space-y-2",children:(0,a.jsx)("p",{className:"text-lg",style:{fontSize:"".concat(c/16,"rem")},children:t})}):null}var E=s(5084),A=s(9602),T=s(9246),O=s(6699),R=s(8173),D=s.n(R),M=s(6046);function _(){let[e,t]=(0,r.useState)(!1),[s,h]=(0,r.useState)(!1),[p,g]=(0,r.useState)(""),[v,w]=(0,r.useState)(""),[j,k]=(0,r.useState)({cameras:[],mics:[]}),[R,_]=(0,r.useState)(!1),[L,P]=(0,r.useState)(!1),U=(0,M.useSearchParams)(),[z,Z]=(0,r.useState)(""),G=(0,r.useRef)(null),V=(0,r.useRef)(null),{isLoading:$,response:K,getResponse:F}=function(){let[e,t]=(0,r.useState)(!1),[s,a]=(0,r.useState)(""),{toast:n}=function(){let[e,t]=r.useState(N);return r.useEffect(()=>(y.push(t),()=>{let e=y.indexOf(t);e>-1&&y.splice(e,1)}),[e]),{...e,toast:b,dismiss:e=>S({type:"DISMISS_TOAST",toastId:e})}}();return{isLoading:e,response:s,getResponse:async(e,s)=>{t(!0);try{let t=await x(e,s);if(t.error)return n({title:"Error",description:t.error,variant:"destructive"}),null;return a(t.text),t.text}catch(e){return n({title:"Error",description:"Failed to get AI response. Please try again.",variant:"destructive"}),null}finally{t(!1)}}}}(),{language:W}=(0,E.o)(),q=(0,r.useRef)(null);(0,r.useRef)(null);let{fontSize:B,lineHeight:H,letterSpacing:Y,accentColor:J}=(0,C.t)(),[X,Q]=(0,r.useState)(!0),{speak:ee,stop:et,isPlaying:es}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onStart:t,onEnd:s,onError:a}=e,[n,i]=(0,r.useState)(!1),l=(0,r.useRef)(null);return{speak:(0,r.useCallback)(e=>{if(!("speechSynthesis"in window)){console.error("Speech synthesis is not supported in this browser.");return}l.current&&(window.speechSynthesis.cancel(),l.current=null);let r=new SpeechSynthesisUtterance(e);l.current=r,r.onstart=()=>{i(!0),null==t||t()},r.onend=()=>{i(!1),null==s||s()},r.onerror=e=>{i(!1),null==a||a(e.error)},window.speechSynthesis.speak(r)},[t,s,a]),stop:(0,r.useCallback)(()=>{l.current&&(window.speechSynthesis.cancel(),l.current=null,i(!1))},[]),isPlaying:n}}({onStart:()=>{s&&(er(!1),_(!0))},onEnd:()=>{R&&(er(!0),_(!1))},onError:e=>{console.error("Speech synthesis error:",e),R&&(er(!0),_(!1))}});(0,r.useEffect)(()=>{(async function(){try{let e=await navigator.mediaDevices.enumerateDevices(),t=e.filter(e=>"videoinput"===e.kind),s=e.filter(e=>"audioinput"===e.kind);k({cameras:t,mics:s});let a=null;try{let e=(a=await navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:"environment"}}})).getVideoTracks()[0],s=t.find(t=>t.deviceId===e.getSettings().deviceId);s&&g(s.deviceId)}catch(e){console.warn("Back camera not found, selecting default camera."),t.length>0&&g(t[0].deviceId)}finally{a&&a.getTracks().forEach(e=>e.stop())}s.length&&w(s[0].deviceId)}catch(e){console.error("Error getting devices:",e)}})()},[]),(0,r.useEffect)(()=>{(async function(){j.cameras.length>0&&j.mics.length>0&&(await ea(!0),await er(!0))})()},[j]);let ea=async function(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!X)try{if((e||s)&&(V.current&&V.current.getTracks().forEach(e=>e.stop()),G.current&&(G.current.srcObject=null)),!e||s){let e=await navigator.mediaDevices.getUserMedia({video:{deviceId:p}});G.current&&(G.current.srcObject=e),V.current=e}t(!e||s)}catch(e){console.error("Error toggling camera:",e)}},er=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!X)try{if(s&&!e&&(V.current&&V.current.getTracks().forEach(e=>{"audio"===e.kind&&e.stop()}),q.current&&q.current.stop()),!s||e){let e=await navigator.mediaDevices.getUserMedia({audio:{deviceId:v}});V.current=e,ei()}h(!s||e)}catch(e){console.error("Error toggling microphone:",e)}},en=async()=>{if(!G.current)return null;let e=document.createElement("canvas");e.width=G.current.videoWidth,e.height=G.current.videoHeight;let t=e.getContext("2d");return t?(t.drawImage(G.current,0,0),e.toDataURL("image/jpeg").split(",")[1]):null},ei=()=>{if(!("SpeechRecognition"in window||"webkitSpeechRecognition"in window)){console.error("Speech recognition is not supported in this browser.");return}let t=window.SpeechRecognition||window.webkitSpeechRecognition;if(!t){console.error("Speech recognition is not supported in this browser.");return}q.current=new t,q.current.lang=W,q.current.interimResults=!1,q.current.maxAlternatives=1,q.current.onresult=async t=>{let s=t.results[0][0].transcript.trim().toLowerCase();if(console.log('Voice command detected: "'.concat(s,'"')),await er(!1),await ec(s))R||await er(!0);else{Z(s);let t=e?await en():void 0;await F(s,"string"==typeof t?t:void 0)}},q.current.onerror=e=>{console.error("Speech recognition error:",e.error)},q.current.onend=()=>{if(s&&!R){var e;null===(e=q.current)||void 0===e||e.start()}},q.current.start()},el=(0,r.useCallback)(async()=>{K&&ee(K)},[K,ee]),ec=(0,r.useCallback)(async e=>e.includes("start camera")?(await ea(!0),ee("Camera started"),!0):e.includes("stop camera")?(await ea(!1),ee("Camera stopped"),!0):e.includes("start mic")?(await er(!0),ee("Microphone started"),!0):e.includes("stop mic")?(await et(),await er(!1),ee("Microphone stopped"),!0):!!(e.includes("repeat")||e.includes("respeak"))&&(await el(),!0),[ee,ea,er,et,el]),eo=async()=>{if(j.cameras.length>1){let e=(j.cameras.findIndex(e=>e.deviceId===p)+1)%(j.cameras.length+1);e===j.cameras.length?(g(""),await ea(!1)):(g(j.cameras[e].deviceId),await ea(!0))}else await ea()},ed=async()=>{if(j.mics.length>1){let e=(j.mics.findIndex(e=>e.deviceId===v)+1)%(j.mics.length+1);e===j.mics.length?(w(""),await er(!1)):(w(j.mics[e].deviceId),await er(!0))}else await er()};(0,r.useEffect)(()=>{let e=()=>{let e=U.get("input");e&&(Z(e),eu()),Q(!1)};if("complete"!==document.readyState)return window.addEventListener("load",e),()=>{window.removeEventListener("load",e)};e()},[U]);let eu=async()=>{if(X||!z.trim())return;let t=e?await en():void 0;await F(z,"string"==typeof t?t:void 0),Z("")};return(0,a.jsxs)("div",{className:"flex w-100 flex-col space-y-4 my-4",style:{fontSize:"".concat(B/16,"rem"),lineHeight:H,letterSpacing:"".concat(Y,"px")},children:[(0,a.jsx)("div",{className:"relative h-[50vh] shrink-0",children:(0,a.jsxs)(i.Zp,{className:"h-full w-full overflow-hidden",children:[(0,a.jsx)("video",{ref:G,autoPlay:!0,playsInline:!0,muted:!0,className:(0,A.cn)("w-full h-full object-cover",!e&&"hidden")}),!e&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-muted",children:(0,a.jsx)(c.A,{className:"w-12 h-12 text-muted-foreground"})})]})}),(0,a.jsx)("div",{className:"h-[15vh] overflow-y-auto",children:(0,a.jsx)(i.Zp,{className:"h-full p-4",children:K?(0,a.jsx)(I,{response:K,isLoading:$,onResponseEnd:()=>{s&&er()}}):(0,a.jsxs)("div",{className:"text-gray-500",children:["Known Bugs ",(0,a.jsx)("br",{})," • Speech output not working ",(0,a.jsx)("br",{})," • Some UI elements aren't mobile friendly and out of place"]})})}),(0,a.jsx)(O.O,{open:L,onOpenChange:P}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-100 xl:flex-row",children:[(0,a.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:e?"default":"outline",onClick:async()=>{await eo(),ee(e?"Camera stopped":"Camera started")},className:"flex-1 relative min-h-[48px]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[e?(0,a.jsx)(o.A,{className:"mr-2"}):(0,a.jsx)(c.A,{className:"mr-2"}),(0,a.jsx)("span",{children:e?"Stop Camera":"Start Camera"})]}),(()=>{let t=e?"Live":"Off";if(j.cameras.length>1){let s=j.cameras.findIndex(e=>e.deviceId===p);t=e?"Live ".concat(s+1," of ").concat(j.cameras.length):"Off ".concat(s+1," of ").concat(j.cameras.length)}else 1===j.cameras.length&&(t=e?"Live (only 1 device)":"Off (only 1 device)");return e?(0,a.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),(0,a.jsx)("span",{className:"text-s text-green-500",children:t})]}):(0,a.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,a.jsx)("span",{className:"text-s text-red-500",children:t})]})})()]})}),(0,a.jsx)(T.ZI,{side:"top",align:"center",children:j.cameras.length>1?"Click to toggle camera, cycles through devices and off":"Click to toggle camera"})]}),(0,a.jsxs)(T.m_,{children:[(0,a.jsx)(T.k$,{asChild:!0,children:(0,a.jsxs)(n.$,{variant:s?"default":"outline",onClick:async()=>{await ed(),ee(s?"Microphone stopped":"Microphone started")},className:"flex-1 relative min-h-[48px]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[s?(0,a.jsx)(d.A,{className:"mr-2"}):(0,a.jsx)(u.A,{className:"mr-2"}),(0,a.jsx)("span",{children:s?"Stop Mic":"Start Mic"})]}),(()=>{let e=s?"Listening":"Off";if(j.mics.length>1){let t=j.mics.findIndex(e=>e.deviceId===v);e=s?"Listening ".concat(t+1," of ").concat(j.mics.length):"Off ".concat(t+1," of ").concat(j.mics.length)}else 1===j.mics.length&&(e=s?"Listening (only 1 device)":"Off (only 1 device)");return es?(0,a.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-yellow-500 animate-pulse"}),(0,a.jsx)("span",{className:"text-s text-yellow-500",children:"Paused"})]}):s?(0,a.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-green-500 animate-pulse"}),(0,a.jsx)("span",{className:"text-s text-green-500",children:e})]}):(0,a.jsxs)("div",{className:"absolute left-3 top-2 flex items-center gap-1",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-red-500"}),(0,a.jsx)("span",{className:"text-s text-red-500",children:e})]})})()]})}),(0,a.jsxs)(T.ZI,{side:"top",align:"center",children:[j.mics.length>1?"Click to toggle microphone, cycles through devices and off":"Click to toggle microphone",(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{children:"Available voice commands:"}),(0,a.jsxs)("ul",{className:"list-disc pl-4",children:[(0,a.jsx)("li",{children:"start camera"}),(0,a.jsx)("li",{children:"stop camera"}),(0,a.jsx)("li",{children:"start mic"}),(0,a.jsx)("li",{children:"stop mic"}),(0,a.jsx)("li",{children:"repeat"}),(0,a.jsx)("li",{children:"respeak"})]})]})]})]}),(0,a.jsx)(n.$,{asChild:!0,variant:"secondary",className:"flex-1 relative min-h-[48px]",children:(0,a.jsxs)(D(),{href:"/call-assistant",children:[(0,a.jsx)(m.A,{className:"mr-2"}),(0,a.jsx)("span",{children:"Call Assistance"})]})})]}),(0,a.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,a.jsx)(l.p,{value:z,onChange:e=>Z(e.target.value),placeholder:"Type your question or command...",onKeyDown:e=>{"Enter"===e.key&&eu()},className:"flex-1"}),(0,a.jsx)(n.$,{className:"w-10 h-10",variant:"accent",onClick:eu,style:{backgroundColor:J},children:(0,a.jsx)(f.A,{className:"w-10 h-10"})})]})]})]})}var L=s(7837),P=s(3348),U=s(8867);function z(e){let{onComplete:t}=e,{fontSize:s,accentColor:r}=(0,C.t)();return(0,a.jsx)(L.lG,{open:!0,onOpenChange:t,children:(0,a.jsxs)(L.Cf,{className:"sm:max-w-[425px]",style:{fontSize:"".concat(s/16,"rem")},children:[(0,a.jsxs)(L.c7,{children:[(0,a.jsx)(L.L3,{children:"Welcome to Lifesight"}),(0,a.jsx)(L.rr,{children:"Let's get you started with using our AI-powered assistant."})]}),(0,a.jsxs)("div",{className:"py-4 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(o.A,{className:"w-5 h-5 mt-0.5",style:{color:r}}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:"Camera Access"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"We'll use your camera to help understand your surroundings"})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(d.A,{className:"w-5 h-5 mt-0.5",style:{color:r}}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:"Voice Commands"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Speak naturally to interact with the assistant"})]})]}),(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)(P.A,{className:"w-5 h-5 mt-0.5",style:{color:r}}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:"Text Input"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Type your questions if you prefer text communication"})]})]})]}),(0,a.jsx)(L.Es,{children:(0,a.jsxs)(n.$,{onClick:t,className:"w-full",style:{backgroundColor:r},children:[(0,a.jsx)(U.A,{className:"w-4 h-4 mr-2"}),"Get Started"]})})]})})}var Z=s(4721);function G(){let[e,t]=(0,Z.M)("hasSeenOnboarding",!1),[s,n]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{n(!0),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).catch(e=>console.error("Error accessing media devices:",e))},[]),s)?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("main",{className:(0,A.cn)("bg-background overflow-hidden"),children:(0,a.jsxs)(T.Bc,{children:[(0,a.jsx)(_,{}),!e&&(0,a.jsx)(z,{onComplete:()=>t(!0)})]})})}):null}},5007:(e,t,s)=>{"use strict";s.d(t,{Zp:()=>l});var a=s(5155),r=s(2115),n=s(9602),i=s(7215);let l=r.forwardRef((e,t)=>{var s;let{className:r,...l}=e,{accentColor:c}=(0,i.t)();return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),style:{backgroundColor:(null===(s=l.style)||void 0===s?void 0:s.backgroundColor)||void 0},...l})});l.displayName="Card",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:s,...r}=e,{fontSize:l}=(0,i.t)();return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("font-semibold leading-none tracking-tight",s),style:{fontSize:"".concat(l/16*1.5,"rem")},...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:s,...r}=e,{fontSize:l}=(0,i.t)();return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-muted-foreground",s),style:{fontSize:"".concat(l/16*.875,"rem")},...r})}).displayName="CardDescription",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})}).displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},2336:(e,t,s)=>{"use strict";s.d(t,{p:()=>l});var a=s(5155),r=s(2115),n=s(9602),i=s(7215);let l=r.forwardRef((e,t)=>{let{className:s,type:r,onKeyPress:l,...c}=e,{fontSize:o}=(0,i.t)();return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex w-full rounded-md border border-input bg-background px-3 py-2 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 sm:h-10 h-10",s),ref:t,style:{fontSize:"".concat(o/16*.875,"rem")},onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),c.onKeyDown&&c.onKeyDown(e))},...c})});l.displayName="Input"}},e=>{var t=t=>e(e.s=t);e.O(0,[193,713,83,686,441,517,358],()=>t(1607)),_N_E=e.O()}]);